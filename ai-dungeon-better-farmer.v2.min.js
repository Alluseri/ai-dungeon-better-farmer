// ==UserScript==
// @name         AI Dungeon Better Farmer
// @namespace    https://www.youtube.com/playlist?list=PLuPCd5VIscosG72QWT03BBZriNDEbryea
// @version      2.0
// @description  Gets rid of the need to spend your precious time to watch ads.
// @author       Alluseri
// @match        https://play.aidungeon.io/*
// @icon         https://cdn.discordapp.com/attachments/853155168170147910/1022980412731039855/hibi_transp.ico
// @grant        none
// ==/UserScript==

!function(){"use strict";var e;const n=document.querySelector.bind(document);function t(e,n,t,o){var a=document.createElement(e);for(let e in n||{})a[e]=n[e];var r=o?"Array"==o.constructor.name?o:[o]:[];for(let e in r)a.appendChild(r[e]);return(t||(e=>e))(a)}const o=(e,n)=>(e.style.cssText=n.style.cssText,e);function a(e,n){return{operationName:"EventHookSendUserEvent",variables:{input:{eventName:e,variation:"mobile",clientInfo:n}},query:"mutation EventHookSendUserEvent($input: EventInput) {\n  sendUserEvent(input: $input)\n}\n"}}async function r(n){return await(await fetch("https://api.aidungeon.io/graphql",{method:"POST",body:JSON.stringify(n),headers:{authorization:e,"content-type":"application/json",accept:"*/*"}})).json()}function i(e){var i=e.firstElementChild,s=i.firstElementChild,d=s.lastElementChild,c=async function(e,t){var o={os:"mobile",model:navigator.userAgent.toLowerCase(),version:"unknown"},i=a("ad_reward_button_press",o),s=a("ad_rewarded_reward_earned",o),d={operationName:"IncreaseAdCounterAdContext",variables:{},query:"mutation IncreaseAdCounterAdContext($addActions: Int) {\n  increaseAdCountdown(addActions: $addActions)\n}\n"};e.style.backgroundColor="#F64627",e.style.borderColor="#E24C32",t?(r(i),r(s),r(d)):(await r(i),await r(s),await r(d)),e.style.backgroundColor="#43DB7C",e.style.borderColor="#30F178",n('img[src="https://static.aidungeon.io/artwork/actions.png"]').parentElement.parentElement.parentElement.lastElementChild.firstElementChild.innerText=(await r({operationName:"UserContextGetAdCountdown",variables:{},query:"query UserContextGetAdCountdown {\n  adCountdown {\n    id\n    currentCount\n    enforceAds\n    shouldAutoplayAds\n    __typename\n  }\n}\n"})).data.adCountdown.currentCount,e.style.backgroundColor=e.ogBg,e.style.borderColor=e.ogBorder};t("div",{className:i.className},(n=>(n.style.cssText=i.style.cssText,n.ogBg=n.style.backgroundColor="#112244",n.ogBorder=n.style.borderColor="#223355",n.onclick=c.bind(window,n,!1),e.appendChild(n),n)),t("div",{className:s.className},(e=>o(e,s)),t("div",{className:d.className,innerText:"+20 ACTIONS"},(e=>o(e,d))))),t("div",{className:i.className},(n=>(n.style.cssText=i.style.cssText,n.ogBg=n.style.backgroundColor="#113355",n.ogBorder=n.style.borderColor="#224466",n.onclick=c.bind(window,n,!0),e.appendChild(n),n)),t("div",{className:s.className},(e=>o(e,s)),t("div",{className:d.className,innerText:"+20 ACTIONS [FAST]"},(e=>o(e,d)))))}function s(){var e=window.setTimeout;window.setTimeout=function(t){var o=n('[aria-label="Commands list"]');return o?(i(o),window.setTimeout=e,e.apply(window,arguments)):e.apply(window,arguments)}}var d;d=window.WebSocket.prototype.send,window.WebSocket.prototype.send=function(n){var t=JSON.parse(n);return"connection_init"==t.type&&(e=t.payload.token,window.WebSocket.prototype.send=d),d.apply(this,arguments)};var c=document.location.href;window.onload=function(){document.location.href.includes("/main/adventurePlay")&&s(),new MutationObserver((function(e){e.forEach((function(e){c!=document.location.href&&(c=document.location.href,document.location.href.includes("/main/adventurePlay")&&s())}))})).observe(document.querySelector("body"),{childList:!0,subtree:!0})}}();
